<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Golang | mgo - Rich MongoDB Driver for Go [è¯‘] - ijayer</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="zher" /><meta name="description" content="mgo-mongodb driver for go" /><meta name="keywords" content="go, golang, mongodb" />






<meta name="generator" content="Hugo 0.55.6 with even 4.0.0" />


<link rel="canonical" href="https://ijayer.github.io/post/tech/code/golang/20180127-lib-mgo/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<link href="/dist/even.93844dae.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Golang | mgo - Rich MongoDB Driver for Go [è¯‘]" />
<meta property="og:description" content="mgo-mongodb driver for go" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ijayer.github.io/post/tech/code/golang/20180127-lib-mgo/" />
<meta property="article:published_time" content="2018-01-27T16:07:43&#43;08:00"/>
<meta property="article:modified_time" content="2018-05-10T16:07:43&#43;00:00"/>

<meta itemprop="name" content="Golang | mgo - Rich MongoDB Driver for Go [è¯‘]">
<meta itemprop="description" content="mgo-mongodb driver for go">


<meta itemprop="datePublished" content="2018-01-27T16:07:43&#43;08:00" />
<meta itemprop="dateModified" content="2018-05-10T16:07:43&#43;00:00" />
<meta itemprop="wordCount" content="3981">



<meta itemprop="keywords" content="golang,mongodb," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Golang | mgo - Rich MongoDB Driver for Go [è¯‘]"/>
<meta name="twitter:description" content="mgo-mongodb driver for go"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">ijayer</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/categories/footprint/">
        <li class="mobile-menu-item">FootPrint</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">ijayer</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/footprint/">FootPrint</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Golang | mgo - Rich MongoDB Driver for Go [è¯‘]</h1>

      <div class="post-meta">
        <span class="post-time"> 2018-01-27 </span>
        <div class="post-category">
            <a href="/categories/tech/"> tech </a>
            </div>
          <span class="more-meta"> 3981 words </span>
          <span class="more-meta"> 8 mins read </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> times read </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
<ul>
<li><a href="#1-highlights-å¼ºè°ƒ">1. Highlights(å¼ºè°ƒ)</a>
<ul>
<li><a href="#1-1-cluster-discovery-and-communication-é›†ç¾¤å‘ç°å’Œé€šä¿¡">1.1. Cluster discovery and communication(é›†ç¾¤å‘ç°å’Œé€šä¿¡)</a></li>
<li><a href="#1-2-failover-management-æ•…éšœè½¬ç§»ç®¡ç†">1.2. Failover management(æ•…éšœè½¬ç§»ç®¡ç†)</a></li>
<li><a href="#1-3-synchronous-and-concurrent-åŒæ­¥å’Œå¹¶å‘">1.3. Synchronous and concurrent(åŒæ­¥å’Œå¹¶å‘)</a></li>
<li><a href="#1-4-result-pre-fecthing-ç»“æœé¢„å–">1.4. Result pre-fecthing(ç»“æœé¢„å–)</a></li>
<li><a href="#1-5-flexible-serialization-çµæ´»çš„åºåˆ—åŒ–">1.5. Flexible serialization(çµæ´»çš„åºåˆ—åŒ–)</a></li>
<li><a href="#1-6-trivial-consistency-level-management-æ™®é€šçš„ä¸€è‡´æ€§çº§åˆ«ç®¡ç†">1.6. Trivial consistency-level management(æ™®é€šçš„ä¸€è‡´æ€§çº§åˆ«ç®¡ç†)</a></li>
<li><a href="#1-7-authentication-support-with-pooling-integration-èº«ä»½éªŒè¯æ”¯æŒä¸æ± é›†æˆ">1.7. Authentication support with pooling integration(èº«ä»½éªŒè¯æ”¯æŒä¸æ± é›†æˆ)</a></li>
<li><a href="#1-8-gridfs-support">1.8. GridFS support</a></li>
</ul></li>
<li><a href="#2-api-documentation">2. API documentation</a></li>
<li><a href="#3-example">3. Example</a></li>
<li><a href="#4-session-and-pool">4. Session and Pool</a>
<ul>
<li><a href="#4-1-session-mode">4.1. Session mode</a>
<ul>
<li><a href="#4-1-1-strong">4.1.1. Strong</a></li>
<li><a href="#4-1-2-monotonic-å•ä¸€çš„">4.1.2. Monotonic(å•ä¸€çš„)</a></li>
<li><a href="#4-1-3-eventual">4.1.3. Eventual</a></li>
<li><a href="#4-1-4-summary">4.1.4. Summary</a></li>
</ul></li>
<li><a href="#4-2-session-çš„æ‹·è´å’Œå¹¶å‘">4.2. Session çš„æ‹·è´å’Œå¹¶å‘</a></li>
</ul></li>
<li><a href="#5-mgo-dialinfo">5. mgo.DialInfo</a></li>
<li><a href="#6-index">6. Index</a>
<ul>
<li><a href="#6-1-å…³äºindexçš„ä¸€äº›ç†è§£">6.1. å…³äºIndexçš„ä¸€äº›ç†è§£</a></li>
</ul></li>
<li><a href="#7-æ•…éšœæ’é™¤å’Œæ€§èƒ½è°ƒä¼˜">7. æ•…éšœæ’é™¤å’Œæ€§èƒ½è°ƒä¼˜</a></li>
<li><a href="#8-see-also">8. See Also</a></li>
</ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <!-- æ‘˜è¦ -->

<blockquote>
<p><a href="http://labix.org/mgo">è¯‘ï¼šRich MongoDB Driver for Go</a></p>
</blockquote>

<p><span id="content"><a href="#content"><strong>ç›®å½•</strong></a></span></p>

<!-- TOC -->

<ul>
<li><a href="#1-highlightså¼ºè°ƒ">1. Highlights(å¼ºè°ƒ)</a>

<ul>
<li><a href="#11-cluster-discovery-and-communicationé›†ç¾¤å‘ç°å’Œé€šä¿¡">1.1. Cluster discovery and communication(é›†ç¾¤å‘ç°å’Œé€šä¿¡)</a></li>
<li><a href="#12-failover-managementæ•…éšœè½¬ç§»ç®¡ç†">1.2. Failover management(æ•…éšœè½¬ç§»ç®¡ç†)</a></li>
<li><a href="#13-synchronous-and-concurrentåŒæ­¥å’Œå¹¶å‘">1.3. Synchronous and concurrent(åŒæ­¥å’Œå¹¶å‘)</a></li>
<li><a href="#14-result-pre-fecthingç»“æœé¢„å–">1.4. Result pre-fecthing(ç»“æœé¢„å–)</a></li>
<li><a href="#15-flexible-serializationçµæ´»çš„åºåˆ—åŒ–">1.5. Flexible serialization(çµæ´»çš„åºåˆ—åŒ–)</a></li>
<li><a href="#16-trivial-consistency-level-managementæ™®é€šçš„ä¸€è‡´æ€§çº§åˆ«ç®¡ç†">1.6. Trivial consistency-level management(æ™®é€šçš„ä¸€è‡´æ€§çº§åˆ«ç®¡ç†)</a></li>
<li><a href="#17-authentication-support-with-pooling-integrationèº«ä»½éªŒè¯æ”¯æŒä¸æ± é›†æˆ">1.7. Authentication support with pooling integration(èº«ä»½éªŒè¯æ”¯æŒä¸æ± é›†æˆ)</a></li>
<li><a href="#18-gridfs-support">1.8. GridFS support</a></li>
</ul></li>
<li><a href="#2-api-documentation">2. API documentation</a></li>
<li><a href="#3-example">3. Example</a></li>
<li><a href="#4-session-and-pool">4. Session and Pool</a>

<ul>
<li><a href="#41-session-mode">4.1. Session mode</a></li>
<li><a href="#411-strong">4.1.1. Strong</a></li>
<li><a href="#412-monotonicå•ä¸€çš„">4.1.2. Monotonic(å•ä¸€çš„)</a></li>
<li><a href="#413-eventual">4.1.3. Eventual</a></li>
<li><a href="#414-summary">4.1.4. Summary</a></li>
<li><a href="#42-session-çš„æ‹·è´å’Œå¹¶å‘">4.2. Session çš„æ‹·è´å’Œå¹¶å‘</a></li>
</ul></li>
<li><a href="#5-mgodialinfo">5. mgo.DialInfo</a></li>
<li><a href="#6-index">6. Index</a>

<ul>
<li><a href="#61-å…³äºindexçš„ä¸€äº›ç†è§£">6.1. å…³äºIndexçš„ä¸€äº›ç†è§£</a></li>
</ul></li>
<li><a href="#7-æ•…éšœæ’é™¤å’Œæ€§èƒ½è°ƒä¼˜">7. æ•…éšœæ’é™¤å’Œæ€§èƒ½è°ƒä¼˜</a></li>
<li><a href="#8-see-also">8. See Also</a></li>
</ul>

<!-- /TOC -->

<h1 id="1-highlights-å¼ºè°ƒ">1. Highlights(å¼ºè°ƒ)</h1>

<h2 id="1-1-cluster-discovery-and-communication-é›†ç¾¤å‘ç°å’Œé€šä¿¡">1.1. Cluster discovery and communication(é›†ç¾¤å‘ç°å’Œé€šä¿¡)</h2>

<p>mgo offers automated cluster topology(æ‹“æ‰‘) discovery and maintenance(ç»´æŠ¤). Even if provided the address to a single server in the cluster, mgo will figure out(æ‰¾å‡º) the cluster topology and communicate with any of the servers as necessary.</p>

<blockquote>
<p>è¯‘ï¼š<code>mgo</code> æä¾›è‡ªåŠ¨åŒ–çš„é›†ç¾¤æ‹“æ‰‘å‘ç°å’Œç»´æŠ¤ã€‚ å³ä½¿å°†åœ°å€æä¾›ç»™é›†ç¾¤ä¸­çš„å•ä¸ªæœåŠ¡å™¨ï¼Œmgoä¹Ÿä¼šæ ¹æ®éœ€è¦æ‰¾å‡ºé›†ç¾¤æ‹“æ‰‘ç»“æ„å¹¶äºä»»ä½•æœåŠ¡å™¨é€šä¿¡ã€‚</p>
</blockquote>

<h2 id="1-2-failover-management-æ•…éšœè½¬ç§»ç®¡ç†">1.2. Failover management(æ•…éšœè½¬ç§»ç®¡ç†)</h2>

<p>mgo will automatically failover in the event that the master server changes.</p>

<h2 id="1-3-synchronous-and-concurrent-åŒæ­¥å’Œå¹¶å‘">1.3. Synchronous and concurrent(åŒæ­¥å’Œå¹¶å‘)</h2>

<p>mgo offers a synchronous interface, with a concurrent backend. Concurrent operations on the same socket do not wait for the previous operation&rsquo;s roundtrip before being delivered. Documents may also start being processed as soon as the first document is received from the network, and will continue being received in the background so that the connection is unblocked for further requests.</p>

<blockquote>
<p>è¯‘ï¼šmgoæä¾›äº†ä¸€ä¸ªåŒæ­¥æ¥å£ï¼Œå¹¶å‘åç«¯ã€‚ åœ¨ä¼ é€’ä¹‹å‰ï¼ŒåŒä¸€ä¸ªå¥—æ¥å­—ä¸Šçš„å¹¶å‘æ“ä½œä¸ä¼šç­‰å¾…ä¸Šä¸€ä¸ªæ“ä½œçš„å¾€è¿”ã€‚ ä¸€æ—¦ä»ç½‘ç»œæ¥æ”¶åˆ°ç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶ä¹Ÿå¯èƒ½å¼€å§‹å¤„ç†ï¼Œå¹¶ä¸”å°†ç»§ç»­åœ¨åå°æ¥æ”¶ï¼Œä»¥ä¾¿è¿™ä¸ªè¿æ¥å¯¹æœªæ¥çš„è¯·æ±‚ä¸ä¼šé˜»å¡æ‰ã€‚</p>
</blockquote>

<h2 id="1-4-result-pre-fecthing-ç»“æœé¢„å–">1.4. Result pre-fecthing(ç»“æœé¢„å–)</h2>

<p>mgo offers configurable pre-fetching of documents, so that the next batch of results are requested automatically when an established percentage of the current batch has been processed.</p>

<blockquote>
<p>è¯‘ï¼šmgo æä¾›å¯é…ç½®çš„æ–‡æ¡£é¢„å–åŠŸèƒ½ï¼Œä¸€è¾¹å½“å½“å‰æ‰¹å·²ç»è¢«å¤„ç†å»ºç«‹ç™¾åˆ†æ¯”çš„æ—¶å€™å¯ä»¥ä½¿ä¸‹ä¸€æ‰¹çš„ç»“æœè‡ªåŠ¨è¢«è¯·æ±‚ã€‚</p>
</blockquote>

<h2 id="1-5-flexible-serialization-çµæ´»çš„åºåˆ—åŒ–">1.5. Flexible serialization(çµæ´»çš„åºåˆ—åŒ–)</h2>

<p>mgo supports flexible marshalling and unmarshalling of documents through gobson, a brand new BSON package written specifically to support mgo.</p>

<h2 id="1-6-trivial-consistency-level-management-æ™®é€šçš„ä¸€è‡´æ€§çº§åˆ«ç®¡ç†">1.6. Trivial consistency-level management(æ™®é€šçš„ä¸€è‡´æ€§çº§åˆ«ç®¡ç†)</h2>

<p>mgo offers trivial(æ™®é€šçš„) consistency-level selection to tweak resource usage vs. read/write ordering guarantees.(ä¿è¯)</p>

<p>Strong consistency uses a unique connection with the master so that all reads and writes are as up-to-date(æœ€æ–°) as possible and consistent with each other.</p>

<p>Monotonic consistency will start reading from a slave if possible, so that the load is better distributed, and once the first write happens the connection is switched to the master. This offers consistent reads and writes, but may not show the most up-to-date data on reads which precede the first write.</p>

<p>Eventual consistency offers the best resource usage, distributing reads across multiple slaves and writes across multiple connections to the master, but consistency isn&rsquo;t guaranteed.</p>

<p>Note that this mechanism(æœºåˆ¶) works both when connecting through a mongos server and when connecting directly to a replica set.</p>

<blockquote>
<p>è¯‘ï¼š</p>

<ul>
<li>mgoæä¾›ç®€å•çš„ä¸€è‡´æ€§çº§åˆ«é€‰æ‹©æ¥è°ƒæ•´èµ„æºä½¿ç”¨ä¸ è¯»/å†™ é¡ºåºä¿è¯ã€‚</li>
<li>å¼ºä¸€è‡´æ€§ä½¿ç”¨ä¸ä¸»æ§åˆ¶å™¨çš„ç‹¬ç‰¹è¿æ¥ï¼Œä»¥ä¾¿æ‰€æœ‰çš„è¯»å†™æ“ä½œéƒ½å°½å¯èƒ½åœ°ä¿æŒæœ€æ–°ï¼Œå¹¶ä¸”å½¼æ­¤ä¿æŒä¸€è‡´ã€‚</li>
<li>å¦‚æœå¯èƒ½çš„è¯ï¼Œå•è°ƒä¸€è‡´æ€§å°†å¼€å§‹ä»ä¸€ä¸ªä»æœºè¯»å–ï¼Œè¿™æ ·è´Ÿè½½åˆ†é…å°±ä¼šæ›´å¥½ï¼Œä¸€æ—¦å‘ç”Ÿç¬¬ä¸€æ¬¡å†™å…¥ï¼Œè¿æ¥å°±åˆ‡æ¢åˆ°ä¸»æœºã€‚ è¿™æä¾›äº†ä¸€è‡´çš„è¯»å–å’Œå†™å…¥ï¼Œä½†å¯èƒ½ä¸ä¼šæ˜¾ç¤ºç¬¬ä¸€æ¬¡å†™å…¥ä¹‹å‰çš„æœ€æ–°è¯»å–åˆ°çš„æ•°æ®ã€‚</li>
<li>æœ€ç»ˆçš„ä¸€è‡´æ€§æä¾›äº†æœ€ä½³çš„èµ„æºåˆ©ç”¨ç‡ï¼Œå°†è¯»å–åˆ†å¸ƒåœ¨å¤šä¸ªä»æœåŠ¡å™¨ä¸Šï¼Œå¹¶é€šè¿‡å¤šä¸ªè¿æ¥å†™å…¥ä¸»æœåŠ¡å™¨ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯ä¸€è‡´æ€§ã€‚</li>
<li>è¯·æ³¨æ„ï¼Œè¿™ç§æœºåˆ¶åœ¨é€šè¿‡mongosæœåŠ¡å™¨è¿æ¥å’Œç›´æ¥è¿æ¥åˆ°å‰¯æœ¬é›†æ—¶éƒ½èµ·ä½œç”¨ã€‚</li>
</ul>
</blockquote>

<h2 id="1-7-authentication-support-with-pooling-integration-èº«ä»½éªŒè¯æ”¯æŒä¸æ± é›†æˆ">1.7. Authentication support with pooling integration(èº«ä»½éªŒè¯æ”¯æŒä¸æ± é›†æˆ)</h2>

<p>mgo offers authentication support, with great connection pooling integration.</p>

<p>This enables mgo to talk to protected servers and replica sets in a very comfortable way. Even with a straightforward(ç®€å•çš„) API, the authentication is internally cached in a secure way to avoid constant(ä¸æ–­çš„) roundtrips to the database. The use of nonces is also optimized so that logins are usually performed(å±¥è¡Œ) with a single roundtrip to the database.</p>

<blockquote>
<p>è¯‘ï¼šè¿™ä½¿å¾—mgoèƒ½å¤Ÿä»¥éå¸¸èˆ’é€‚çš„æ–¹å¼ä¸å—ä¿æŠ¤çš„æœåŠ¡å™¨å’Œå‰¯æœ¬é›†è¿›è¡Œå¯¹è¯ã€‚ å³ä½¿ä½¿ç”¨ç®€å•çš„APIï¼Œèº«ä»½éªŒè¯ä¹Ÿä¼šä»¥ä¸€ç§å®‰å…¨çš„æ–¹å¼è¿›è¡Œå†…éƒ¨ç¼“å­˜ï¼Œä»¥é¿å…å¾€è¿”äºæ•°æ®åº“ã€‚ éšæœºæ•°çš„ä½¿ç”¨ä¹Ÿè¿›è¡Œäº†ä¼˜åŒ–ï¼Œä»¥ä¾¿ç™»å½•é€šå¸¸æ˜¯å•å‘å¾€è¿”æ•°æ®åº“ã€‚</p>
</blockquote>

<h2 id="1-8-gridfs-support">1.8. GridFS support</h2>

<p>mgo can be used to send and receive files to MongoDB using the standard GridFS specification(è§„èŒƒ) for file storage. This means that it may share the same database collections used for file storage with drivers for other languages, and also the command line tools provided with MongoDB itself (e.g. mongofiles).</p>

<p>In addition to a selection(é€‰æ‹©) of relevant(ç›¸åº”çš„) methods, the *mgo.GridFile type implements support for both io.Reader and io.Writer interfaces, which means it integrates nicely with the standard library.</p>

<blockquote>
<p>è¯‘ï¼š</p>

<ul>
<li>mgoå¯ä»¥ç”¨æ¥å‘é€å’Œæ¥æ”¶æ–‡ä»¶åˆ°MongoDBä½¿ç”¨æ ‡å‡†çš„GridFSè§„èŒƒçš„æ–‡ä»¶å­˜å‚¨ã€‚ è¿™æ„å‘³ç€å®ƒå¯ä»¥ä¸å…¶ä»–è¯­è¨€çš„é©±åŠ¨ç¨‹åºå…±äº«ç”¨äºæ–‡ä»¶å­˜å‚¨çš„ç›¸åŒæ•°æ®åº“é›†åˆï¼Œä¹Ÿå¯ä»¥å…±äº«MongoDBæœ¬èº«æä¾›çš„å‘½ä»¤è¡Œå·¥å…·ï¼ˆå¦‚mongofilesï¼‰ã€‚</li>
<li>é™¤äº†é€‰æ‹©ç›¸å…³çš„æ–¹æ³•ä¹‹å¤–ï¼Œ* mgo.GridFileç±»å‹å®ç°äº†å¯¹io.Readerå’Œio.Writeræ¥å£çš„æ”¯æŒï¼Œè¿™æ„å‘³ç€å®ƒä¸æ ‡å‡†åº“å¾ˆå¥½åœ°é›†æˆã€‚</li>
</ul>
</blockquote>

<p><a href="#content"><strong>è¿”å›ç›®å½•</strong></a></p>

<h1 id="2-api-documentation">2. API documentation</h1>

<ul>
<li><a href="http://gopkg.in/mgo.v2">API docs for mgo</a></li>
<li><a href="http://gopkg.in/mgo.v2/bson">API docs for mgo/bson</a></li>
<li><a href="http://gopkg.in/mgo.v2/txn">API docs for mgo/txn</a></li>
</ul>

<h1 id="3-example">3. Example</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&#34;fmt&#34;</span>
    <span class="s">&#34;log&#34;</span>
    <span class="s">&#34;gopkg.in/mgo.v2&#34;</span>
    <span class="s">&#34;gopkg.in/mgo.v2/bson&#34;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Person</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Name</span>  <span class="kt">string</span>
    <span class="nx">Phone</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">session</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">mgo</span><span class="p">.</span><span class="nf">Dial</span><span class="p">(</span><span class="s">&#34;server1.example.com, server2.example.com&#34;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">defer</span> <span class="nx">session</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>

    <span class="c1">// Optional. Switch the session to a monotonic(å•è°ƒçš„) behavior(è¡Œä¸º).
</span><span class="c1"></span>    <span class="nx">session</span><span class="p">.</span><span class="nf">SetMode</span><span class="p">(</span><span class="nx">mgo</span><span class="p">.</span><span class="nx">Monotonic</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>

    <span class="nx">c</span> <span class="o">:=</span> <span class="nx">session</span><span class="p">.</span><span class="nx">DB</span><span class="p">.(</span><span class="s">&#34;test&#34;</span><span class="p">).</span><span class="nf">C</span><span class="p">(</span><span class="s">&#34;people&#34;</span><span class="p">)</span>
    <span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Insert</span><span class="p">(</span>
        <span class="o">&amp;</span><span class="nx">Person</span><span class="p">{</span><span class="s">&#34;Ale&#34;</span><span class="p">,</span> <span class="s">&#34;+55 53 8116 9639&#34;</span><span class="p">},</span>
        <span class="o">&amp;</span><span class="nx">Person</span><span class="p">{</span><span class="s">&#34;Cla&#34;</span><span class="p">,</span> <span class="s">&#34;+55 53 8402 8510&#34;</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">result</span> <span class="o">:=</span> <span class="nx">Person</span><span class="p">{}</span>
    <span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="nx">bson</span><span class="p">.</span><span class="nx">M</span><span class="p">{</span><span class="s">&#34;name&#34;</span><span class="p">:</span> <span class="s">&#34;Ale&#34;</span><span class="p">}).</span><span class="nf">One</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">result</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Phone:&#34;</span><span class="p">,</span> <span class="nx">result</span><span class="p">.</span><span class="nx">Phone</span><span class="p">)</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p><a href="#content"><strong>è¿”å›ç›®å½•</strong></a></p>

<h1 id="4-session-and-pool">4. Session and Pool</h1>

<p>Dialæ–¹æ³•å’ŒMongoDBæ•°æ®åº“å»ºç«‹äº†é“¾æ¥åä¼šè¿”å›ä¸€ä¸ªmgo.Sessionå¯¹è±¡ï¼›å¯ä»¥ç”¨è¯¥å¯¹è±¡ç®¡ç†æ‰€æœ‰çš„CRUDæ“ä½œ, ä¸” session èƒ½å¤Ÿå’Œ mongodb é›†ç¾¤ä¸­çš„æ‰€æœ‰Serveré€šè®¯ã€‚</p>

<p>Sessionç®¡ç†MongoDBæœåŠ¡å™¨ç¾¤çš„è¿æ¥æ± ï¼Œ ä¸€ä¸ªè¿æ¥æ± æ˜¯æ•°æ®åº“é“¾æ¥çš„ç¼“å­˜ï¼Œæ‰€ä»¥å½“æ–°çš„è¯·æ±‚è¿æ¥æ•°æ®åº“çš„æ“ä½œä¼šé‡ç”¨å·²ç”¨çš„è¿æ¥ã€‚</p>

<p>åœ¨ä¸€ä¸ªç‹¬ç«‹çš„httpè¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸï¼ŒNew(), Copy(), Clone()æ–¹æ³•ä¼šåˆ›å»ºSessionï¼Œä¼šè·å–Dialæ–¹æ³•åˆ›å»ºçš„Sessionã€‚</p>

<ul>
<li>New(): åˆ›å»ºæ–°çš„Sessionå¯¹è±¡ï¼Œå’Œå·²åˆ›å»ºSessionæœ‰åŒæ ·çš„å‚æ•°ï¼›</li>
<li>Copy(): ä¿ç•™åŸæœ‰çš„Sessionä¿¡æ¯ï¼›</li>
<li>Clone(): å’ŒCopy()å‡½æ•°ä¸€æ ·ï¼Œä½†ä¼šé‡ç”¨åŸæ¥çš„Sessionå»ºç«‹çš„Socketè¿æ¥ã€‚</li>
</ul>

<h2 id="4-1-session-mode">4.1. Session mode</h2>

<blockquote>
<p>mgo çš„ session.SetModeå‡½æ•°è¯´æ˜</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// SetMode changes the consistecy mode for the session.
</span><span class="c1">// SetMode å‡½æ•°ç”¨æ¥å˜æ¢ session çš„ä¸€è‡´æ€§æ¨¡å¼
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">Session</span><span class="p">)</span> <span class="nf">SetMode</span><span class="p">(</span><span class="nx">consistency</span> <span class="nx">mode</span><span class="p">,</span> <span class="nx">refresh</span> <span class="kt">bool</span><span class="p">)</span></code></pre></td></tr></table>
</div>
</div>
<h3 id="4-1-1-strong">4.1.1. Strong</h3>

<p>In the Strong consistency mode reads and writes will always be made to
the primary server using a unique connection so that reads and writes are
fully consistent, ordered, and observing the most up-to-date data.
This offers the least benefits in terms of distributing load, but the
most guarantees.  See also Monotonic and Eventual.</p>

<blockquote>
<p>è¯‘ï¼šåœ¨å¼ºä¸€è‡´æ¨¡å¼ä¸‹ï¼Œè¯»å†™éƒ½æ˜¯åœ¨ä¸»èŠ‚ç‚¹ä¸Šé€šè¿‡ä¸€ä¸ªå”¯ä¸€çš„è¿æ¥å®ç°ï¼Œè¿™æ ·è¯»å†™æ—¶å®Œå…¨ä¸€è‡´ï¼Œæœ‰åºå¹¶ä¸”å‘ˆç°æœ€æ–°çš„æ•°æ®ã€‚è¿™ç§æ¨¡å¼åœ¨åˆ†å¸ƒå¼è´Ÿè½½æ¶æ„ä¸‹æ²¡æœ‰å¤šå°‘ç›Šå¤„ï¼Œä½†æ˜¯ä¿è¯äº†è¯»å†™æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p>
</blockquote>

<h3 id="4-1-2-monotonic-å•ä¸€çš„">4.1.2. Monotonic(å•ä¸€çš„)</h3>

<p>In the Monotonic consistency mode reads may not be entirely up-to-date, but they will always see the history of changes moving forward, the data read will be consistent across sequential queries in the same session, and modifications made within the session will be observed in following queries (read-your-writes).</p>

<blockquote>
<p>è¯‘ï¼šåœ¨ Monotonic ä¸€è‡´æ€§æ¨¡å¼ä¸‹ï¼Œè¯»åˆ°çš„æ•°æ®ä¸ä¸€å®šæ—¶æœ€æ–°çš„ï¼Œä½†æ˜¯åœ¨åŒä¸€ä¸ªsessionä¸­çš„ä¸€ç³»åˆ—è¯»ä¿æŒç€æ•°æ®çš„ä¸€è‡´æ€§ï¼Œè€Œsessionä¸­çš„ä¿®æ”¹åœ¨å…¶åçš„æŸ¥è¯¢ä¸­å¯ä»¥å¾—åˆ°ä½“ç°ã€‚</p>

<p>Note: session çš„è¯»æ“ä½œå¼€å§‹æ—¶å‘å…¶ä»–æœåŠ¡å™¨å‘èµ·(ä¸”é€šè¿‡ä¸€ä¸ªå”¯ä¸€çš„è¿æ¥)ï¼Œ åªè¦å‡ºç°äº†ä¸€æ¬¡å†™æ“ä½œï¼Œsessionçš„è¿æ¥å°±ä¼šåˆ‡æ¢è‡³ä¸»æœåŠ¡å™¨ã€‚ç”±æ­¤å¯è§æ­¤æ¨¡å¼ä¸‹ï¼Œèƒ½å¤Ÿåˆ†æ•£ä¸€äº›è¯»æ“ä½œåˆ°å…¶ä»–æœåŠ¡å™¨ï¼Œä½†æ˜¯è¯»æ“ä½œä¸ä¸€å®šèƒ½å¤Ÿè·å¾—æœ€æ–°çš„æ•°æ®ã€‚</p>
</blockquote>

<h3 id="4-1-3-eventual">4.1.3. Eventual</h3>

<p>session çš„è¯»æ“ä½œä¼šå‘ä»»æ„çš„å…¶ä»–æœåŠ¡å™¨å‘èµ·ï¼Œå¤šæ¬¡è¯»æ“ä½œå¹¶ä¸ä¸€å®šä½¿ç”¨ç›¸åŒçš„è¿æ¥ï¼Œä¹Ÿå°±æ˜¯è¯»æ“ä½œä¸ä¸€å®šæœ‰åºã€‚session çš„å†™æ“ä½œæ€»æ˜¯å‘ä¸»æœåŠ¡å™¨å‘èµ·ï¼Œä½†æ˜¯å¯èƒ½ä½¿ç”¨ä¸åŒçš„è¿æ¥ï¼Œä¹Ÿå°±æ˜¯å†™æ“ä½œä¹Ÿä¸ä¸€å®šæœ‰åºã€‚</p>

<h3 id="4-1-4-summary">4.1.4. Summary</h3>

<table>
<thead>
<tr>
<th></th>
<th>Strong</th>
<th>Monotonic</th>
<th>Eventual</th>
</tr>
</thead>

<tbody>
<tr>
<td>read</td>
<td>read to primary</td>
<td>read to arbitraryï¼ˆéšæœºçš„ï¼‰primary</td>
<td>read to any secondary</td>
</tr>

<tr>
<td>write</td>
<td>write to primary</td>
<td>write to primary</td>
<td>wirte to primary</td>
</tr>

<tr>
<td>connection</td>
<td>unique</td>
<td>unique</td>
<td>independent</td>
</tr>

<tr>
<td>guarantee</td>
<td>the most</td>
<td>some useful</td>
<td>the least</td>
</tr>
</tbody>
</table>

<p><a href="#content"><strong>è¿”å›ç›®å½•</strong></a></p>

<h2 id="4-2-session-çš„æ‹·è´å’Œå¹¶å‘">4.2. Session çš„æ‹·è´å’Œå¹¶å‘</h2>

<h1 id="5-mgo-dialinfo">5. mgo.DialInfo</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// DialInfo holds options for establishing a session with a MongoDB cluster.
</span><span class="c1">// To use a URL, see the Dial function.
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">DialInfo</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// Addrs holds the addresses for the seed servers.
</span><span class="c1"></span>	<span class="nx">Addrs</span> <span class="p">[]</span><span class="kt">string</span>

	<span class="c1">// Direct informs whether to establish connections only with the
</span><span class="c1"></span>	<span class="c1">// specified seed servers, or to obtain information for the whole
</span><span class="c1"></span>	<span class="c1">// cluster and establish connections with further servers too.
</span><span class="c1"></span>	<span class="nx">Direct</span> <span class="kt">bool</span>

	<span class="c1">// Timeout is the amount of time to wait for a server to respond when
</span><span class="c1"></span>	<span class="c1">// first connecting and on follow up operations in the session. If
</span><span class="c1"></span>	<span class="c1">// timeout is zero, the call may block forever waiting for a connection
</span><span class="c1"></span>	<span class="c1">// to be established. Timeout does not affect logic in DialServer.
</span><span class="c1"></span>	<span class="nx">Timeout</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>

	<span class="c1">// FailFast will cause connection and query attempts to fail faster when
</span><span class="c1"></span>	<span class="c1">// the server is unavailable, instead of retrying until the configured
</span><span class="c1"></span>	<span class="c1">// timeout period. Note that an unavailable server may silently drop
</span><span class="c1"></span>	<span class="c1">// packets instead of rejecting them, in which case it&#39;s impossible to
</span><span class="c1"></span>	<span class="c1">// distinguish it from a slow server, so the timeout stays relevant.
</span><span class="c1"></span>	<span class="nx">FailFast</span> <span class="kt">bool</span>

	<span class="c1">// Database is the default database name used when the Session.DB method
</span><span class="c1"></span>	<span class="c1">// is called with an empty name, and is also used during the initial
</span><span class="c1"></span>	<span class="c1">// authentication if Source is unset.
</span><span class="c1"></span>	<span class="nx">Database</span> <span class="kt">string</span>

	<span class="c1">// ReplicaSetName, if specified, will prevent the obtained session from
</span><span class="c1"></span>	<span class="c1">// communicating with any server which is not part of a replica set
</span><span class="c1"></span>	<span class="c1">// with the given name. The default is to communicate with any server
</span><span class="c1"></span>	<span class="c1">// specified or discovered via the servers contacted.
</span><span class="c1"></span>	<span class="nx">ReplicaSetName</span> <span class="kt">string</span>

	<span class="c1">// Source is the database used to establish credentials and privileges
</span><span class="c1"></span>	<span class="c1">// with a MongoDB server. Defaults to the value of Database, if that is
</span><span class="c1"></span>	<span class="c1">// set, or &#34;admin&#34; otherwise.
</span><span class="c1"></span>	<span class="nx">Source</span> <span class="kt">string</span>

	<span class="c1">// Service defines the service name to use when authenticating with the GSSAPI
</span><span class="c1"></span>	<span class="c1">// mechanism. Defaults to &#34;mongodb&#34;.
</span><span class="c1"></span>	<span class="nx">Service</span> <span class="kt">string</span>

	<span class="c1">// ServiceHost defines which hostname to use when authenticating
</span><span class="c1"></span>	<span class="c1">// with the GSSAPI mechanism. If not specified, defaults to the MongoDB
</span><span class="c1"></span>	<span class="c1">// server&#39;s address.
</span><span class="c1"></span>	<span class="nx">ServiceHost</span> <span class="kt">string</span>

	<span class="c1">// Mechanism defines the protocol for credential negotiation.
</span><span class="c1"></span>	<span class="c1">// Defaults to &#34;MONGODB-CR&#34;.
</span><span class="c1"></span>	<span class="nx">Mechanism</span> <span class="kt">string</span>

	<span class="c1">// Username and Password inform the credentials for the initial authentication
</span><span class="c1"></span>	<span class="c1">// done on the database defined by the Source field. See Session.Login.
</span><span class="c1"></span>	<span class="nx">Username</span> <span class="kt">string</span>
	<span class="nx">Password</span> <span class="kt">string</span>

	<span class="c1">// PoolLimit defines the per-server socket pool limit. Defaults to 4096.
</span><span class="c1"></span>	<span class="c1">// See Session.SetPoolLimit for details.
</span><span class="c1"></span>	<span class="nx">PoolLimit</span> <span class="kt">int</span>

	<span class="c1">// DialServer optionally specifies the dial function for establishing
</span><span class="c1"></span>	<span class="c1">// connections with the MongoDB servers.
</span><span class="c1"></span>	<span class="nx">DialServer</span> <span class="kd">func</span><span class="p">(</span><span class="nx">addr</span> <span class="o">*</span><span class="nx">ServerAddr</span><span class="p">)</span> <span class="p">(</span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>

	<span class="c1">// WARNING: This field is obsolete. See DialServer above.
</span><span class="c1"></span>	<span class="nx">Dial</span> <span class="kd">func</span><span class="p">(</span><span class="nx">addr</span> <span class="nx">net</span><span class="p">.</span><span class="nx">Addr</span><span class="p">)</span> <span class="p">(</span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<h1 id="6-index">6. Index</h1>

<p>ç´¢å¼•æ—¶ä¸€ç§ç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œç´¢å¼•å­˜å‚¨åœ¨ä¸€ä¸ªæ˜“äºéå†è¯»å–çš„æ•°æ®é›†åˆä¸­ï¼Œç´¢å¼•æ˜¯å¯¹æ•°æ®åº“è¡¨ä¸­ä¸€åˆ—æˆ–è€…å¤šåˆ—çš„å€¼è¿›è¡Œæ’åºçš„ä¸€ç§ç»“æ„ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Index</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">Key</span>        <span class="p">[]</span><span class="kt">string</span> <span class="c1">// Index key fields; prefix name with dash (-) for descending order
</span><span class="c1"></span>	<span class="nx">Unique</span>     <span class="kt">bool</span>     <span class="c1">// Prevent two documents from having the same index key
</span><span class="c1"></span>	<span class="nx">DropDups</span>   <span class="kt">bool</span>     <span class="c1">// Drop documents with the same index key as a previously indexed one
</span><span class="c1"></span>	<span class="nx">Background</span> <span class="kt">bool</span>     <span class="c1">// Build index in background and return immediately
</span><span class="c1"></span>	<span class="nx">Sparse</span>     <span class="kt">bool</span>     <span class="c1">// Only index documents containing the Key fields
</span><span class="c1"></span>
	<span class="c1">// If ExpireAfter is defined the server will periodically delete
</span><span class="c1"></span>	<span class="c1">// documents with indexed time.Time older than the provided delta.
</span><span class="c1"></span>	<span class="nx">ExpireAfter</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>

	<span class="c1">// Name holds the stored index name. On creation if this field is unset it is
</span><span class="c1"></span>	<span class="c1">// computed by EnsureIndex based on the index key.
</span><span class="c1"></span>	<span class="nx">Name</span> <span class="kt">string</span>
	<span class="c1">// ...
</span><span class="c1"></span><span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p>Note:</p>

<ul>
<li><p>Key []string: ç´¢å¼•å­—æ®µ(é»˜è®¤å‡åºæ’åº)ï¼Œå…¶å‰ç¼€åŠ  <code>-</code> è¡¨ç¤ºæŒ‰é™åºæ’åº</p></li>

<li><p>Unique bool: è®¾ç½®å»ºç«‹çš„ç´¢å¼•æ˜¯å¦å”¯ä¸€(é»˜è®¤ä¸ºfalse)ã€‚</p></li>

<li><p>DropDups bool: åœ¨å»ºç«‹å”¯ä¸€ç´¢å¼•æ—¶æ˜¯å¦åˆ é™¤é‡å¤è®°å½•ï¼ŒæŒ‡å®šä¸ºtrueåˆ™åˆ›å»ºå”¯
ä¸€ç´¢å¼•ã€‚(é»˜è®¤ä¸ºfalse)</p></li>

<li><p>Backgroud bool å»ºç«‹ç´¢å¼•è¿‡ç¨‹ä¼šé˜»å¡å…¶ä»–æ•°æ®åº“æ“ä½œï¼ŒbackgroudæŒ‡å®šåœ¨åå°åˆ›å»ºç´¢å¼•ï¼Œå®Œæˆåç«‹å³è¿”å›ã€‚(é»˜è®¤å€¼ä¸ºfalse)</p></li>

<li><p>Sparse bool: å¯¹æ–‡æ¡£ä¸­ä¸å­˜åœ¨çš„å­—æ®µæ•°æ®ä¸å¯ç”¨ç´¢å¼•ï¼›è¿™ä¸ªå‚æ•°è¦ç‰¹åˆ«æ³¨æ„ï¼Œå¦‚æœè®¾ç½®ä¸ºtrueçš„è¯ï¼Œåœ¨ç´¢å¼•å­—æ®µä¸­ä¸ä¼šæŸ¥è¯¢å‡ºä¸åŒ…å«å¯¹åº”çš„å­—æ®µçš„æ–‡æ¡£ã€‚(é»˜è®¤å€¼ä¸ºfalse)</p></li>

<li><p>Name stringï¼› ç´¢å¼•çš„åç§°ï¼Œå¦‚æœæœªæŒ‡å®šï¼ŒMongoDBé€šè¿‡è¿æ¥ç´¢å¼•çš„å­—æ®µåç§°å’Œæ’åºé¡ºåºç”Ÿæˆä¸€ä¸ªç´¢å¼•åç§°ã€‚</p></li>

<li><p>ExpireAfterSeconds time.Duration: å¦‚æœå®šä¹‰äº†ExpireAfterï¼Œåˆ™æœåŠ¡å™¨å°†å®šæœŸåˆ é™¤ç´¢å¼•æ—¶é—´æ—©äºæä¾›çš„å¢é‡çš„æ–‡æ¡£ã€‚</p></li>
</ul>

<h2 id="6-1-å…³äºindexçš„ä¸€äº›ç†è§£">6.1. å…³äºIndexçš„ä¸€äº›ç†è§£</h2>

<ul>
<li><a href="https://docs.mongodb.com/manual/indexes/">https://docs.mongodb.com/manual/indexes/</a></li>
<li><a href="http://www.mongoing.com/archives/2797">http://www.mongoing.com/archives/2797</a></li>
<li><a href="https://itbilu.com/database/mongo/E1tWQz4_e.html">https://itbilu.com/database/mongo/E1tWQz4_e.html</a></li>
<li><a href="https://www.guru99.com/create-read-update-operations-mongodb.html">https://www.guru99.com/create-read-update-operations-mongodb.html</a></li>
<li><a href="https://www.tutorialspoint.com/mongodb/mongodb_indexing.htm">https://www.tutorialspoint.com/mongodb/mongodb_indexing.htm</a></li>
<li><a href="https://www.compose.com/articles/mongodb-indexing-best-practices/">https://www.compose.com/articles/mongodb-indexing-best-practices/</a></li>
<li><a href="https://blog.haohtml.com/archives/12873">https://blog.haohtml.com/archives/12873</a></li>
<li><a href="https://blog.laisky.com/p/mgo/">https://blog.laisky.com/p/mgo/</a></li>
<li><a href="https://www.jianshu.com/p/ab48dd5541a8">https://www.jianshu.com/p/ab48dd5541a8</a></li>
</ul>

<h1 id="7-æ•…éšœæ’é™¤å’Œæ€§èƒ½è°ƒä¼˜">7. æ•…éšœæ’é™¤å’Œæ€§èƒ½è°ƒä¼˜</h1>

<ul>
<li><a href="https://www.gmarik.info/blog/2017/testing-mongodb-queries-golang/">https://www.gmarik.info/blog/2017/testing-mongodb-queries-golang/</a></li>
<li><a href="http://blog.51cto.com/xinsir/2051629">http://blog.51cto.com/xinsir/2051629</a></li>
<li><a href="https://lamada.eu/blog/2016/11/08/troubleshooting-mongodb-queries-performance/">https://lamada.eu/blog/2016/11/08/troubleshooting-mongodb-queries-performance/</a></li>
<li><a href="https://yq.aliyun.com/articles/226367">https://yq.aliyun.com/articles/226367</a></li>
<li><a href="https://wangming1993.github.io/2016/01/27/the-summary-of-mongodb-index/">https://wangming1993.github.io/2016/01/27/the-summary-of-mongodb-index/</a></li>
<li><a href="https://www.kancloud.cn/yujc/mongodb_note/383929">https://www.kancloud.cn/yujc/mongodb_note/383929</a></li>
<li><a href="https://docs.mongodb.com/manual/reference/explain-results/">https://docs.mongodb.com/manual/reference/explain-results/</a></li>
<li><a href="http://www.mongoing.com/eshu_explain2">http://www.mongoing.com/eshu_explain2</a></li>
</ul>

<h1 id="8-see-also">8. See Also</h1>

<blockquote>
<p>Thanks to the authors ğŸ™‚</p>
</blockquote>

<ul>
<li><a href="https://my.oschina.net/ricktian1226/blog/346207">Session Mode</a></li>
<li><a href="https://cardinfolink.github.io/2017/05/17/mgo-session/#top">Session Pool</a></li>
</ul>

<p><a href="#content"><strong>è¿”å›ç›®å½•</strong></a></p>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">zher</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">2018-05-10</span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div><footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/golang/">golang</a>
          <a href="/tags/mongodb/">mongodb</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/essay/20180209-poetry-%E5%BD%92%E4%B9%A1%E5%8C%97%E6%96%B9/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">ã€Šå½’ä¹¡Â·åŒ—æ–¹ã€‹</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/tech/code/golang/20171113-go-unit-test/">
            <span class="next-text nav-default">Golang | å•å…ƒæµ‹è¯•</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js" crossorigin="anonymous"></script>
    <script type="text/javascript">
      var gitalk = new Gitalk({
        id: '2018-01-27 16:07:43 \x2b0800 CST',
        title: 'Golang | mgo - Rich MongoDB Driver for Go [è¯‘]',
        clientID: '4357c1dbcf7ef0515c29',
        clientSecret: '1ad00adfd9544bff956529daf898d4b81fed2a9d',
        repo: 'blog-comments',
        owner: 'ijayer',
        admin: ['ijayer'],
        body: decodeURI(location.href)
      });
      gitalk.render('gitalk-container');
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/gitalk/gitalk">comments powered by gitalk.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:zhezh.boy@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://twitter.com/JayerCheung" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://www.facebook.com/zhe.zh.54" class="iconfont icon-facebook" title="facebook"></a>
      <a href="https://plus.google.com/u/0/103084907763171979239" class="iconfont icon-google" title="google"></a>
      <a href="https://github.com/iJayer" class="iconfont icon-github" title="github"></a>
      <a href="https://weibo.com/p/1005053510554731/home?from=page_100505&amp;mod=TAB&amp;is_all=1#place" class="iconfont icon-weibo" title="weibo"></a>
      <a href="https://www.zhihu.com/people/boy-zhe/activities" class="iconfont icon-zhihu" title="zhihu"></a>
      <a href="https://www.instagram.com/zher09/" class="iconfont icon-instagram" title="instagram"></a>
  <a href="https://ijayer.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> site pv: <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> site uv: <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2018 - 
    2019
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">jayer</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
<script type="text/javascript" src="/dist/even.ece58db6.min.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-123995495-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







</body>
</html>
