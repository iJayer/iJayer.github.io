<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Tools | Make &amp; Makefile 学习笔记 （一） - Zher&#39;s Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="zher" /><meta name="description" content="make and makefile 学习笔记" />
<meta name="keywords" content="make, makefile" />







<meta name="generator" content="Hugo 0.46" />


<link rel="canonical" href="https://zhezh09.github.io/post/tech/tools/20180904-make-makefile-%E7%AC%94%E8%AE%B0/" />

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">


<script src="https://cdn.jsdelivr.net/npm/eruda@1.2.6/eruda.min.js" integrity="sha256-Jmz4bc3kp+rRrXX2tGadNBKFLwtzMapr8kHABxSAAP8=" crossorigin="anonymous"></script>
<script>eruda.init();</script>


<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<link href="/dist/even.min.css?v=3.2.0" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">




<meta property="og:title" content="Tools | Make &amp; Makefile 学习笔记 （一）" />
<meta property="og:description" content="make and makefile 学习笔记" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhezh09.github.io/post/tech/tools/20180904-make-makefile-%E7%AC%94%E8%AE%B0/" />



<meta property="article:published_time" content="2018-09-04T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2018-09-04T00:00:00&#43;00:00"/>











<meta itemprop="name" content="Tools | Make &amp; Makefile 学习笔记 （一）">
<meta itemprop="description" content="make and makefile 学习笔记">


<meta itemprop="datePublished" content="2018-09-04T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2018-09-04T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="3923">



<meta itemprop="keywords" content="tools," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Tools | Make &amp; Makefile 学习笔记 （一）"/>
<meta name="twitter:description" content="make and makefile 学习笔记"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Zher&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/categories/footprint/">
        <li class="mobile-menu-item">FootPrint</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Zher&#39;s Blog</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/footprint/">FootPrint</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Tools | Make &amp; Makefile 学习笔记 （一）</h1>

      <div class="post-meta">
        <span class="post-time"> 2018-09-04 </span>
        <div class="post-category">
            
              <a href="/categories/tech/"> tech </a>
            
          </div>
        <span class="more-meta"> 3923 words </span>
        <span class="more-meta"> 8 mins read </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> times read </span>
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
<ul>
<li><a href="#1-前言">1. 前言</a></li>
<li><a href="#2-make-的概念">2. Make 的概念</a></li>
<li><a href="#3-makefile-文件的格式">3. Makefile 文件的格式</a>
<ul>
<li><a href="#3-1-概述">3.1. 概述</a></li>
<li><a href="#3-2-目标-target">3.2. 目标 (target)</a></li>
<li><a href="#3-3-前置条件-prerequisites">3.3. 前置条件 (prerequisites)</a></li>
<li><a href="#3-4-命令-commands">3.4. 命令 (commands)</a></li>
</ul></li>
<li><a href="#4-makefile-文件的语法">4. Makefile 文件的语法</a>
<ul>
<li><a href="#4-1-注释">4.1. 注释</a></li>
<li><a href="#4-2-回声">4.2. 回声</a></li>
<li><a href="#4-3-通配符">4.3. 通配符</a></li>
<li><a href="#4-4-模式匹配">4.4. 模式匹配</a></li>
<li><a href="#4-5-变量和赋值符">4.5. 变量和赋值符</a></li>
<li><a href="#4-6-内置变量">4.6. 内置变量</a></li>
<li><a href="#4-7-自动变量">4.7. 自动变量</a></li>
<li><a href="#4-8-判断和循环">4.8. 判断和循环</a></li>
<li><a href="#4-9-函数">4.9. 函数</a></li>
</ul></li>
<li><a href="#5-makefile-的实例">5. Makefile 的实例</a>
<ul>
<li><a href="#5-1-执行多个目标">5.1. 执行多个目标</a></li>
<li><a href="#5-2-编译-c-语言项目">5.2. 编译 C 语言项目</a></li>
</ul></li>
<li><a href="#6-see-also">6. See Also</a></li>
</ul>
</nav>
  </div>
</div>

    
    

    
    <div class="post-content">
      <!-- 摘要 -->

<ul>
<li>Make 命令的简单用法</li>
<li>Makefile 的编写规则</li>
</ul>

<p></p>

<blockquote>
<p>Statements: 笔记的内容转自 <a href="http://www.ruanyifeng.com/blog/2015/02/make.html">阮一峰老师的 Make 命令教程</a></p>
</blockquote>

<h1 id="1-前言">1. 前言</h1>

<p>代码变成可执行文件，叫做 <a href="http://www.ruanyifeng.com/blog/2014/11/compiler.html">编译</a> (compile); 先编译这个，还是先编译那个(即编译的安排)，叫做 <a href="http://en.wikipedia.org/wiki/Software_build">构建</a>(build)。</p>

<p><a href="http://en.wikipedia.org/wiki/Make_%28software%29">Make</a> 是最常用的构建工具，诞生于 1977 年，主要用于 C 语言的项目。但是实际上，任何只要某个文件有变化，就要重新构建的项目，都可以用 Make 构建。</p>

<h1 id="2-make-的概念">2. Make 的概念</h1>

<p>Make 这个词，英语的意思是 &ldquo;制作&rdquo;。Make 命令直接用了这个意思，就是要做出某个文件。比如，要做出文件 a.txt, 就可以执行下面的命令。</p>

<pre><code class="language-bash">$ make a.txt
make: *** No targets specified and no makefile found.  Stop.
</code></pre>

<p>如上所示，如果你真的输入了这条命令，它并不会起作用。因为 Make 命令本身并不知道如何做出 a.txt, 需要有人告诉它，如何调用其它命令完成这个目标。</p>

<p>比如，假设文件 a.txt 依赖于 b.txt 和 c.txt，是后面两个文件连接(cat命令)的产物。那么，make 需要知道下面的规则。</p>

<pre><code class="language-bash">a.txt: b.txt c.txt
    cat b.txt c.txt &gt; a.txt
</code></pre>

<p>也就是说，<code>make a.txt</code> 这条命令的背后，实际上分为两步：</p>

<ul>
<li>第一步：确认 b.txt 和 c.txt 必须已经存在</li>
<li>第二步：使用 cat 命令将这两个文件合并，输出为新文件</li>
</ul>

<p>像这样的规则，都卸载一个叫做 Makefile 的文件中，Make 命令依赖这个文件进行构建。Makefile 也可以写作 makefile，或者用命令行参数指定为其他文件名：</p>

<pre><code class="language-bash">$ make -f rules.txt
# or
$ make --file=rules.txt
</code></pre>

<p>上面代码指定 make 命令依据 rules。txt 文件中的规则，进行构建。</p>

<p>总之，<code>make</code> 只是一个根据指定的 Shell 命令进行构建的工具。它的规则很简单，你规定要构建那个文件、它依赖哪些源文件，当那些文件有变动时，如何重新构建它。</p>

<h1 id="3-makefile-文件的格式">3. Makefile 文件的格式</h1>

<p>构建规则都写在 <code>Makefile</code> 文件里面，要学会如何用 make 命令，就必须学会如何编写 Makefile 文件</p>

<h2 id="3-1-概述">3.1. 概述</h2>

<p>Makefile 文件由一系列规则(rules)构成。每条规则的形式如下：</p>

<pre><code class="language-bash">&lt;target&gt;: &lt;prerequisites&gt;
[tab] &lt;commands&gt;
</code></pre>

<p>上面第一行冒号前面的部分，叫做 <code>目标</code>(target), 冒号后面的部分叫做 <code>前置条件</code> (prerequisites); 第二行必须由一个 tab 健起首，后面跟着 <code>命令</code> (commands)</p>

<p><code>目标</code> 是必须的，不可省略；<code>前置条件</code> 和 <code>命令</code> 都是可选的，但是两者之中必须至少存在一个。</p>

<p>每条规则就明确两件事：构建目标的前置条件是什么，以及如何构建。下面就详细讲述每条规则的这三个组成部分。</p>

<h2 id="3-2-目标-target">3.2. 目标 (target)</h2>

<p>一个目标 (target) 就构成一条规则。目标通常是文件名，指明 Make 命令所要构建的对象，比如上文的 a.txt。目标可以是一个文件名，也可以是多个文件名，之间用空格分隔。</p>

<p>除了文件名，目标还可以是某个操作的名字，这称为 <code>伪目标</code> (phony target)</p>

<pre><code class="language-Makefile">clean:
    rm *.o
</code></pre>

<p>上面代码的目标是 clean, 它不是文件名，而是一个操作的名字，属于 <code>伪目标</code>，作用是删除对象文件。</p>

<pre><code class="language-bash">$ make clean
</code></pre>

<p>但是，如果当前目录中，正好有一个文件叫做 clean, 那么这个命令不会去执行。因为 Make 发现 clean 已经文件已经存在，就认为没有必要重新构建了，就不会执行指定的 rm 命令。</p>

<p>为了避免这种情况，可以明确声明 clean 是伪目标，写法如下：</p>

<pre><code class="language-Makefile">.PHONY: clean

clean:
    rm *.o temp
</code></pre>

<p>声明 clean 是伪目标之后，make 就不回去检查是否存在一个叫做 clean 的文件，而是每次运行都执行对应的命令。像 .PHONY 这样的内置目标名还有不少，可以查看 <a href="http://www.gnu.org/software/make/manual/html_node/Special-Targets.html#Special-Targets">手册</a></p>

<p>如果 make 命令运行时没有指定目标，默认会执行 Makefile 文件的第一个目标。</p>

<pre><code class="language-bash">$ make
</code></pre>

<p>上面命令执行 Makefile 文件的第一个目标</p>

<h2 id="3-3-前置条件-prerequisites">3.3. 前置条件 (prerequisites)</h2>

<p>前置条件通常是一组文件名，之间用空格分隔。它指定了 <code>目标</code> 是否重新构建的判断标准：只要有一个前置文件不存在，或者有过更新（前置文件的last-modification时间戳比目标的时间戳新）, <code>目标</code> 就需要重新构建。</p>

<pre><code class="language-Makefile">result.txt: source.txt
    cp source.txt result.txt
</code></pre>

<p>上面代码中，构建 result.txt 的前置条件是 source.txt 。如果当前目录中，source.txt 已经存在，那么make result.txt可以正常运行，否则必须再写一条规则，来生成 source.txt 。</p>

<pre><code class="language-Makefile">source.txt:
    echo &quot;this is the source&quot; &gt; source.txt
</code></pre>

<p>上面代码中，source.txt后面没有前置条件，就意味着它跟其他文件都无关，只要这个文件还不存在，每次调用make source.txt，它都会生成。</p>

<pre><code class="language-bash">$ make result.txt
$ make result.txt
</code></pre>

<p>上面命令连续执行两次make result.txt。第一次执行会先新建 source.txt，然后再新建 result.txt。第二次执行，Make发现 source.txt 没有变动（时间戳晚于 result.txt），就不会执行任何操作，result.txt 也不会重新生成。</p>

<h2 id="3-4-命令-commands">3.4. 命令 (commands)</h2>

<p>命令 (commands) 表示如何更新目标文件，由一行或多行的 shell 命令组成。它是构建 <code>目标</code> 的具体指令，它的运行结果通常就是生成目标文件。</p>

<p>每行命令之前必须有一个 tab 键。如果想用其他键，可以用内置变量 .RECIPEPREFIX 声明。</p>

<pre><code class="language-Makefile">.RECIPEPREFIX = &gt;
all:
&gt; echo Hello, wrold
</code></pre>

<p>上面代码用 .RECIPEPREFIX 指定，大于号 (&gt;) 替代 tab 键。所以，每一行命令的起首变成了大于号，而不是 tab 键。</p>

<blockquote>
<p>需要注意的是，<code>每行命令</code> 在一个单独的 Shell 中执行。这些 Shell 之间没有继承关系</p>
</blockquote>

<pre><code class="language-Makefile">var-lost:
    export foo=bar
    echo &quot;foo=[$$foo]&quot;
</code></pre>

<p>上面代码执行后（make var-lost），取不到foo的值。因为两行命令在两个不同的进程执行。一个解决办法是将两行命令写在一行，中间用分号分隔。</p>

<pre><code class="language-Makefile">var-kept:
    export foo=bar; echo &quot;foo=[$$foo]&quot;
</code></pre>

<p>另一个解决办法是在换行符前加反斜杠转义。</p>

<pre><code class="language-Makefile">var-kept:
    export foo=bar; \
    echo &quot;foo=[$$foo]&quot;
</code></pre>

<p>最后一个方法是加上 <code>.ONESHELL:</code> 命令。</p>

<pre><code>.ONESHELL:
var-kept:
    export foo=bar; 
    echo &quot;foo=[$$foo]&quot;
</code></pre>

<h1 id="4-makefile-文件的语法">4. Makefile 文件的语法</h1>

<h2 id="4-1-注释">4.1. 注释</h2>

<p>井号 (#) 在 Makefile 中表示注释。</p>

<pre><code class="language-Makefile"># 这里是注释
result.txt: source.txt
    # 这是注释
    cp source.txt result.txt # 这也是注释
</code></pre>

<h2 id="4-2-回声">4.2. 回声</h2>

<p>正常情况下，make 会打印每条命令，然后再执行，这就叫做回声 (echoing)</p>

<pre><code class="language-Makefile">test:
    # 这是测试
</code></pre>

<p>执行上面的规则，会得到下面的结果。</p>

<pre><code class="language-bash">$ make test
# 这是测试
</code></pre>

<p>在命令前面加上 <code>@</code>，就可以关闭回声：</p>

<pre><code class="language-Makefile">test: 
    @# 这是测试
</code></pre>

<p>现在再执行 <code>make test</code>，就不会有任何输出</p>

<blockquote>
<p>由于在构建过程中，需要了解当前在执行哪条命令，所以通常只在注释和纯显示的echo命令前面加上@。即：</p>
</blockquote>

<pre><code class="language-Makefile">test: 
    @# 这是测试
    @echo TODO
</code></pre>

<h2 id="4-3-通配符">4.3. 通配符</h2>

<p>通配符（wildcard）用来指定一组符合条件的文件名。Makefile 的通配符与 Bash 一致，主要有星号（*）、问号（？）和 [&hellip;] 。比如， *.o 表示所有后缀名为o的文件。</p>

<pre><code class="language-Makefile">clean:
    rm -f *.o
</code></pre>

<h2 id="4-4-模式匹配">4.4. 模式匹配</h2>

<p>Make 命令允许对文件名，进行类似正则运算的匹配，主要用到的匹配符是 <code>%</code>。比如，假定当前目录下有 f1.c 和 f2.c 两个源码文件，需要将它们编译为对应的对象文件：</p>

<pre><code class="language-Makefile">%.o: %.c
</code></pre>

<p>等同于下面的写法：</p>

<pre><code class="language-Makefile">f1.o: f1.c
f2.o: f2.c
</code></pre>

<p>使用匹配符 %，可以将大量同类型的文件，只用一条规则就完成构建</p>

<h2 id="4-5-变量和赋值符">4.5. 变量和赋值符</h2>

<p>Makefile 允许使用 <code>=</code> 号自定义变量：</p>

<pre><code class="language-Makefile">txt = Hello world
test: 
    @echo $(txt)
</code></pre>

<p>上面代码中，变量 txt 等于 Hello World。调用时，变量需要放在 $( ) 之中。</p>

<p>调用 Shell 变量时，需要在美元符号前，再加一个美元符号，这是因为 Make 命令会对美元符号转义：</p>

<pre><code class="language-Makefile">test:
    @echo $$HOME
</code></pre>

<p>有时，变量的值可能指向另一个变量：</p>

<pre><code class="language-Makefile">v1 = $(v2)
</code></pre>

<p>上面代码中，变量 v1 的值是另一个变量 v2。这时会产生一个问题，v1 的值到底在定义时扩展（静态扩展），还是在运行时扩展（动态扩展）？如果 v2 的值是动态的，这两种扩展方式的结果可能会差异很大。</p>

<p>为了解决类似问题，Makefile一共提供了四个赋值运算符 （=、:=、？=、+=），它们的区别请看<a href="http://stackoverflow.com/questions/448910/makefile-variable-assignment">StackOverflow</a>。</p>

<pre><code class="language-Makefile">VARIABLE = value
# 在执行时扩展，允许递归扩展

VARIABLE := value
# 在定义时扩展

VARIABLE ?= value
# 只有在该变量为空时才设置值

VARIABLE += value
# 将值追加到变量的尾端
</code></pre>

<h2 id="4-6-内置变量">4.6. 内置变量</h2>

<p>Make命令提供一系列内置变量，比如，$(CC) 指向当前使用的编译器，$(MAKE) 指向当前使用的Make工具。这主要是为了跨平台的兼容性，详细的内置变量清单见 <a href="https://www.gnu.org/software/make/manual/html_node/Implicit-Variables.html">手册</a>。</p>

<pre><code class="language-Makefile">output:
    $(CC) -o output input.c
</code></pre>

<h2 id="4-7-自动变量">4.7. 自动变量</h2>

<p>Make 命令还提供一些自动变量，它们的值与当前规划有关。主要有以下几个：</p>

<ul>
<li><p>$@</p>

<p>$@ 指代当前目标，就是 Make 命令当前构建的那个目标。比如，<code>make foo</code> 的 $@ 就指代 foo.</p>

<pre><code class="language-Makefile">a.txt b.txt:
    touch $@
</code></pre>

<p>等同于下面的写法：</p>

<pre><code class="language-Makefile">a.txt: 
    touch a.txt
b.txt:
    touch b.txt
</code></pre></li>

<li><p>$&lt;</p>

<p>$&lt; 指代第一个前置条件。比如，规则为 t: p1 p2, 那么 $&lt; 就指代 p1.</p>

<pre><code class="language-Makefile">a.txt: b.txt c.txt
    cp $&lt; $@
</code></pre>

<p>等同于下面写法：</p>

<pre><code class="language-Makefile">a.txt: b.txt c.txt
    cp b.txt a.txt
</code></pre></li>

<li><p>$?</p>

<p>$? 指代比目标更新的所有前置条件，之间以空格分隔。比如，规则为 t: p1 p2, 其中 p2 的时间戳比 t 新，$? 就指代 p2</p></li>

<li><p>$^</p>

<p>$^ 指代所有前置条件，之间以空格分隔。比如，规则为 t: p1 p2, 那么 $^ 就指代 p1 p2</p></li>

<li><p>$*</p>

<p>$* 指代通配符 % 匹配的部分，比如 % 匹配 f1.txt 中的 f1，$* 就表示 f1</p></li>

<li><p>$(@D) 和 $(@F)</p>

<p>$(@D) 和 $(@F) 分别指向 $@ 的目录名和文件名。比如，$@ 是 <code>src/input.c</code>, 那么 $(@D) 就是 src, $(@F) 的值为 input.c</p></li>

<li><p>$(&lt;D) 和 $(&lt;F)</p>

<p>$(&lt;D) 和 $(&lt;F) 分别指向 $&lt; 的目录名和文件名</p>

<p>所有的自动变量清单，请看 <a href="https://www.gnu.org/software/make/manual/html_node/Automatic-Variables.html">手册</a>。下面是自动变量的一个例子。</p>

<pre><code class="language-Makefile">dest/%.txt: src/%.txt
    @[-d dest] || mkdir dest
    cp $&lt; $@
</code></pre>

<blockquote>
<p>上面代码将 src 目录下的 txt 文件，拷贝到 dest 目录下。首先判断 dest 目录是否存在，如果不存在就新建，然后，$&lt; 指带前置文件 (src/%.txt),  $@ 指代目标文件（dest/%.txt）。</p>
</blockquote></li>
</ul>

<h2 id="4-8-判断和循环">4.8. 判断和循环</h2>

<p>Makefile 使用 Bash 语法，完成判断和循环。</p>

<pre><code class="language-Makefile">ifeq ($(CC),gcc)
  libs=$(libs_for_gcc)
else
  libs=$(normal_libs)
endif
</code></pre>

<p>上面代码判断当前编译器是否 gcc ，然后指定不同的库文件。</p>

<pre><code class="language-Makefile">
LIST = one two three
all:
    for i in $(LIST); do \
        echo $$i; \
    done

# 等同于

all:
    for i in one two three; do \
        echo $i; \
    done

</code></pre>

<p>上面代码的运行结果。</p>

<pre><code>one
two
three
</code></pre>

<h2 id="4-9-函数">4.9. 函数</h2>

<p>Makefile 还可以使用函数，格式如下：</p>

<pre><code class="language-Makefile">$(function arguments)

# 或者

${function arguments}
</code></pre>

<p>Makefile提供了许多<a href="http://www.gnu.org/software/make/manual/html_node/Functions.html">内置函数</a>，可供调用。下面是几个常用的内置函数。</p>

<ul>
<li><p>shell 函数</p>

<p>shell 函数用来执行 shell 命令</p>

<p><code>srcfiles = $(shell echo src{00..99}.txt)</code></p></li>

<li><p>wildcard 函数</p>

<p>wildcard 函数用来在 Makefile 中，替换 Bash 的通配符。</p>

<p><code>srcfiles := $(wildcard src/*.txt)</code></p></li>

<li><p>subst 函数</p>

<p>subst 函数用来文本替换，格式如下。</p>

<p><code>$(subst from,to,text)</code></p>

<p>下面的例子将字符串&rdquo;feet on the street&rdquo;替换成&rdquo;fEEt on the strEEt&rdquo;。</p>

<p><code>$(subst ee,EE,feet on the street)</code></p>

<p>下面是一个稍微复杂的例子。</p>

<pre><code>comma:= ,
empty:=
# space变量用两个空变量作为标识符，当中是一个空格
space:= $(empty) $(empty)
foo:= a b c
bar:= $(subst $(space),$(comma),$(foo))
# bar is now `a,b,c'.
</code></pre></li>

<li><p>patsubst 函数</p>

<p>patsubst 函数用于模式匹配的替换，格式如下。</p>

<p><code>$(patsubst pattern,replacement,text)</code></p>

<p>下面的例子将文件名&rdquo;x.c.c bar.c&rdquo;，替换成&rdquo;x.c.o bar.o&rdquo;。</p>

<p><code>$(patsubst %.c,%.o,x.c.c bar.c)</code></p></li>

<li><p>替换后缀名</p>

<p>替换后缀名函数的写法是：变量名 + 冒号 + 后缀名替换规则。它实际上patsubst函数的一种简写形式。</p>

<p><code>min: $(OUTPUT:.js=.min.js)</code></p>

<p>上面代码的意思是，将变量OUTPUT中的后缀名 .js 全部替换成 .min.js 。</p></li>
</ul>

<h1 id="5-makefile-的实例">5. Makefile 的实例</h1>

<h2 id="5-1-执行多个目标">5.1. 执行多个目标</h2>

<pre><code class="language-Makefile">.PHONY: cleanall cleanobj cleandiff

cleanall: cleanobj cleandiff
    rm program

cleanobj::
    rm *.o

cleandiff:
    rm *.diff
</code></pre>

<blockquote>
<p>上面代码可以调用不同目标，删除不同后缀名的文件，也可以调用一个目标：cleanall 删除所有指定类型的文件</p>
</blockquote>

<h2 id="5-2-编译-c-语言项目">5.2. 编译 C 语言项目</h2>

<pre><code class="language-Makefile">edit: main.o kbd.o command.o display.o
    cc -o edit main.o kbd.o command.o display.o

main.o: main.c defs.h
    cc -c main.c

kbd.o: kbd.c defs.h command.h
    cc -c kbd.c

command.o: command.c defs.h command.h
    cc -c command.c

display.o: display.c defs.h
    cc -c display.c

clean:
    rm edit main.o kbd.o command.o display.o

.PHONY: edit clean
</code></pre>

<p>至此，完。</p>

<h1 id="6-see-also">6. See Also</h1>

<blockquote>
<p>Thanks to the authors 🙂</p>
</blockquote>

<ul>
<li><a href="http://www.ruanyifeng.com/blog/2015/02/make.html">阮一峰老师：Make 命令教程</a></li>
<li><a href="http://www.cs.colby.edu/maxwell/courses/tutorials/maketutor/">A Simple Makefile Tutorial</a></li>
<li><a href="https://seisman.github.io/how-to-write-makefile/index.html">跟我一起写Makefile</a></li>
</ul>
    </div>

    
    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">zher</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">2018-09-04</span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>

    
    

    <footer class="post-footer">
      <div class="post-tags">
          
          <a href="/tags/tools/">tools</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/tech/code/golang/20180904-grpc-00/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Golang | gRPC 学习笔记集</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/tech/code/golang/20180828-feature-go-modules-02/">
            <span class="next-text nav-default">Golang | 依赖管理-02：Go Modules 使用笔记</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        
  

  <div id="gitalk-container"></div>
  <link rel="stylesheet" href="/lib/gitalk/gitalk-1.2.2.min.css">
    <script src="/lib/gitalk/gitalk-1.2.2.min.js"></script>
  <script type="text/javascript">
  var gitalk = new Gitalk({
    id: '2018-09-04 00:00:00 \x2b0000 UTC',
    title: 'Tools | Make \x26 Makefile 学习笔记 （一）',
    clientID: '4357c1dbcf7ef0515c29',
    clientSecret: '1ad00adfd9544bff956529daf898d4b81fed2a9d',
    repo: 'blog-comments',
    owner: 'zhezh09',
    admin: ['zhezh09'],
    body: decodeURI(location.href)
  });
  gitalk.render('gitalk-container');
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://github.com/gitalk/gitalk">comments powered by gitalk.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:zhezh.boy@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://www.facebook.com/zhe.zh.54" class="iconfont icon-facebook" title="facebook"></a>
      <a href="https://plus.google.com/u/0/103084907763171979239" class="iconfont icon-google" title="google"></a>
      <a href="https://github.com/zhezh09" class="iconfont icon-github" title="github"></a>
      <a href="https://weibo.com/p/1005053510554731/home?from=page_100505&amp;mod=TAB&amp;is_all=1#place" class="iconfont icon-weibo" title="weibo"></a>
      <a href="https://www.zhihu.com/people/boy-zhe/activities" class="iconfont icon-zhihu" title="zhihu"></a>
      <a href="https://www.instagram.com/zher09/" class="iconfont icon-instagram" title="instagram"></a>
  <a href="https://zhezh09.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> site pv: <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
    <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> site uv: <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2018
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">zher</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="/lib/highlight/highlight.pack.js?v=20171001"></script><script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>


<script type="text/javascript" src="/dist/even.min.js?v=3.2.0"></script>


<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-123995495-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







</body>
</html>
